const embedding = [-0.1639612764120102, 0.09637340903282166, 0.021112175658345222, -0.04182128235697746, -0.027836207300424576, -0.10658684372901917, 0.027006663382053375, -0.06428105384111404, 0.1372675746679306, -0.059103094041347504, 0.2710859775543213, -0.10584414750337601, -0.16705086827278137, -0.11307720839977264, -0.05385327339172363, 0.09530436247587204, -0.1679980605840683, -0.09918692708015442, -0.006640477105975151, -0.06615672260522842, 0.1382807493209839, -0.08149150013923645, -0.020171796903014183, 0.1466519981622696, -0.11718437820672989, -0.2902233898639679, -0.1068558543920517, -0.15278761088848114, 0.04386846721172333, -0.06873425841331482, -0.04452967643737793, 0.10249865055084229, -0.15123474597930908, -0.0860552042722702, -0.02473454177379608, 0.009543712250888348, 0.027053510770201683, 0.0244754571467638, 0.1830194592475891, -0.003421069122850895, -0.14036767184734344, 0.014248188585042953, 0.0004412541165947914, 0.2812952697277069, 0.19255951046943665, 0.03888149932026863, 0.025726433843374252, -0.009550242684781551, 0.14451341331005096, -0.1899135410785675, -0.059734050184488297, 0.17638571560382843, 0.18542221188545227, 0.06616673618555069, 0.04642888903617859, -0.10741613060235977, 0.00453754048794508, 0.07477228343486786, -0.17302149534225464, 0.050951797515153885, -0.055052269250154495, -0.09182470291852951, 0.046695221215486526, -0.045119624584913254, 0.16557104885578156, 0.03285087272524834, -0.10196192562580109, -0.10685553401708603, 0.14741693437099457, -0.13423699140548706, -0.008406918495893478, 0.15254917740821838, -0.134306401014328, -0.22619648277759552, -0.1850418597459793, 0.11838415265083313, 0.3854483366012573, 0.1621343493461609, -0.1272377073764801, 0.06310217082500458, -0.11669877171516418, -0.09287121891975403, 0.02070348709821701, 0.04027136415243149, -0.08090147376060486, 0.024991879239678383, -0.10734627395868301, 0.016433149576187134, 0.1645175665616989, -0.056189507246017456, -0.0068612489849328995, 0.21169936656951904, -0.041046176105737686, 0.08604320138692856, -0.006074698641896248, 0.010418137535452843, -0.09390312433242798, 0.08479146659374237, -0.04996520280838013, 0.02160285972058773, 0.007929941639304161, -0.109133280813694, -0.010208586230874062, 0.007669664919376373, -0.17327873408794403, 0.06915830820798874, -0.04467662051320076, 0.003952127881348133, -0.1655537486076355, 0.022296670824289322, -0.0931251123547554, 0.03166927769780159, 0.09205073863267899, -0.25864821672439575, 0.18147766590118408, 0.1968914419412613, 0.03699793666601181, 0.1341114193201065, 0.053026944398880005, -0.03691546618938446, 0.03411208838224411, -0.08239084482192993, -0.05809402093291283, -0.05551895499229431, 0.14678174257278442, -0.03388213738799095, 0.03719544783234596, -0.05930430069565773];

function embeddingToString(embedding) {
    const float32 = new Float32Array(embedding);
    const buffer = Buffer.from(float32.buffer);
    const base64Embedding = buffer.toString("base64")
    return base64Embedding;
}

const result = `d+UnvmxfxT1x86w8y0wrvcII5Lw0Stq9FD3dPMmlg73fjww+FhZyvcjLij7RxNi9Yg8rvgaV571AlVy97y7DPa8HLL6EIsu9XJjZuy19h714mQ0+BOWmvVM/pbzxKxY+Xf7vvSmYlL4+19q9W3QcvmyvMz2MxIy9wGQ2vdDq0T1I3Rq+tj2wvRigyrw7XRw8U5/dPMGAyDx0aTs+BDRgu4u8D748cWk8IFjnOe8FkD5SLkU+NUIfPT7A0jyfeBy8U/sTPrJ4Qr6xq3S9dZ40PlLfPT5tgoc9OCw+Pf38272mr5Q7NiKZPYwsMb7VslA9fX5hvZcOvL19Qz89W884vXWLKT6jjgY9atHQvRPX2r139BY+bHUJviy9CbzaNRw+nocJvg2gZ76dez2+ZHPyPXxZxT6MBiY+mkoCvrY7gT3E/+69RDO+vVyaqTyW8yQ9rK+lvcW7zDxd2Nu90J6GPEt3KD74Jma9VNTgu7jHWD4JICi9azewPUQOx7vWsCo8SFDAvSanrT1QqEy9e/iwPJbsATxFgd+96kEnvNBR+zv7bzG+36KNPdX+Nr3agIE77IYpvoKntjxhuL69pbcBPRmFvD2KbYS+SNU5PumdST4mixc9gVQJPsgyWT2sNBe9HrkLPYi8qL3/82292GdjvfRNFj7/xwq9QVoYPRHpcr0=`;

function stringToEmbedding(base64Embedding) {
    const buffer = Buffer.from(base64Embedding, "base64");

    // ⚠️ RESPEITAR offset e length
    const float32 = new Float32Array(
        buffer.buffer,
        buffer.byteOffset,
        buffer.byteLength / Float32Array.BYTES_PER_ELEMENT
    );

    return Array.from(float32);
}

// are they equal?

const embeddingFromString = stringToEmbedding(result);
let areEqual = true;
for (let i = 0; i < embedding.length; i++) {
    if (embedding[i] !== embeddingFromString[i]) {
        console.log(`Not equal at index ${i}: ${embedding[i]} !== ${embeddingFromString[i]}`);
        areEqual = false;
        break;
    }
}

console.log("Are they equal?", areEqual);